<?xml version="1.0" encoding="UTF-8"?><record_update sys_domain="global" table="sys_cb_design_topic">
    <sys_cb_design_topic action="INSERT_OR_UPDATE">
        <compiled_topic display_value="Identify Scheduled Changes">9b9b4b1aeb723300749c3c4fea887e7c</compiled_topic>
        <design_definition>{"type":"FlowTopic","triggers":[{"type":"Trigger","name":"314dc9b0c8e945c78d86564d18c95121","triggerType":"request","id":"314dc9b0c8e945c78d86564d18c95121"}],"goals":[{"name":"primary","trigger_id":"314dc9b0c8e945c78d86564d18c95121","nodes":[{"type":"StartGoal","goal_id":"07bbdfc6ff0f4396be715a7c27798990","greeting_msg":{"type":"String","mode":"string","value":""},"id":"2d4d497ab61846a8a267abf43825699f","name":"Start"},{"type":"TerminateGoal","goal_id":"07bbdfc6ff0f4396be715a7c27798990","confirmation_msg":{"type":"String","mode":"string","value":"gs.getMessage(\"Thanks for using our support chat! Have a great day!\")"},"id":"e225329edbf04e98a0778639049e85c1","name":"End"},{"type":"InputPrompt","variable_id":"6b8b352e39ee4a5ab63a274b83e02c8e","message":{"type":"String","mode":"string","value":"gs.getMessage(\"OK.  What is the name of the configuration item who's changes you would like to see?\")"},"optional":false,"id":"e54d56418c41427dbc8e5aad25b31028","name":"Search Term","goal_id":"07bbdfc6ff0f4396be715a7c27798990"},{"type":"Decision","name":"Decision","branches":[{"type":"Branch","label":"Search Again","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaInputs.configuration_item.getValue() == 'search_again';\n})()\n"},"id":"8bc4620b64b94b549d753b961807fdba","name":"Search Again"},{"type":"Branch","label":"Cancel","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaInputs.configuration_item == 'cancel';\n})()\n"},"id":"9b3042a88f0e4297a5d51dd2bbbb0eb0","name":"Cancel"},{"type":"Branch","label":"Next","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaInputs.configuration_item.getValue() == 'show_next';\n})()\n"},"id":"20c63b8086d948e4a456467fbfdcebd5","name":"Next"},{"type":"Branch","label":"Previous","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaInputs.configuration_item.getValue() == 'show_previous';\n})()\n"},"id":"87d00d5950824aa0af2ccd57f09c60e3","name":"Previous"},{"type":"Branch","label":"Item Selected","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return (vaInputs.configuration_item.getValue() != 'cancel' &amp;&amp;\n        vaInputs.configuration_item.getValue() != 'search_again' &amp;&amp; \n        vaInputs.configuration_item.getValue() != 'show_next' &amp;&amp;\n        vaInputs.configuration_item.getValue() != 'show_previous');\n})()\n"},"id":"abf55588055a469baacde8b09984446f","name":"Item Selected"}],"id":"8d721e089e364ddd91156f40038991b0","goal_id":"07bbdfc6ff0f4396be715a7c27798990"},{"type":"ReferenceChoiceInputPrompt","mode":"external","id":"1f7f2014b37d4eb4bd97a81eb2866c1e","name":"Configuration Item","goal_id":"07bbdfc6ff0f4396be715a7c27798990","variable_id":"11d7e6234f6d41f9b44789f890750165","message":{"type":"String","mode":"string","value":"Please select the CI whose changes you want to see."},"optional":false,"expression_mode":"script","script":"(function execute() {\n    var index = parseInt(vaVars.index);\n    var limit = parseInt(vaVars.limit);\n    \n    var gr = new GlideRecordSecure('cmdb_ci');\n    gr.addQuery('name', 'CONTAINS', vaInputs.search_term);\n    gr.chooseWindow(index, index + limit, true);\n    gr.orderBy('name');\n    gr.query();\n\n    vaVars.count = gr.getRowCount();\n    var options = [];\n    while(gr.next()) {\n        options.push({ \n            'value': gr.getUniqueValue(), 'label': gr.getDisplayValue('name')\n        });\n    }\n\n    if (index &gt; 0) \n        options.push({ 'value': 'show_previous', 'label': gs.getMessage('Show previous')});\n    if (vaVars.count &gt; index + limit)\n        options.push({ 'value': 'show_next', 'label': gs.getMessage('Show more')});\n    \n    options.push({ 'value': 'search_again', 'label': gs.getMessage('Search again')});\n    options.push({ 'value': 'cancel', 'label': gs.getMessage('I\\'m done')});\n\n    return options;    \n})()\n","no_options_found_message":{"type":"String","mode":"string","value":"No Records Found"},"condition":{"type":"Condition","mode":"external_script","value":"(function execute() {\n    var index = parseInt(vaVars.index);\n    var limit = parseInt(vaVars.limit);\n    \n    var gr = new GlideRecordSecure('cmdb_ci');\n    gr.addQuery('name', 'CONTAINS', vaInputs.search_term);\n    gr.chooseWindow(index, index + limit, true);\n    gr.orderBy('name');\n    gr.query();\n\n    vaVars.count = gr.getRowCount();\n    var options = [];\n    while(gr.next()) {\n        options.push({ \n            'value': gr.getUniqueValue(), 'label': gr.getDisplayValue('name')\n        });\n    }\n\n    if (index &gt; 0) \n        options.push({ 'value': 'show_previous', 'label': gs.getMessage('Show previous')});\n    if (vaVars.count &gt; index + limit)\n        options.push({ 'value': 'show_next', 'label': gs.getMessage('Show more')});\n    \n    options.push({ 'value': 'search_again', 'label': gs.getMessage('Search again')});\n    options.push({ 'value': 'cancel', 'label': gs.getMessage('I\\'m done')});\n\n    return options;    \n})()\n"}},{"type":"ScriptedAction","script":"(function execute() {\n    var index = parseInt(vaVars.index);\n    var limit = parseInt(vaVars.limit);\n    var index = index + limit;\n    vaVars.index = index;\n})()\n","id":"161ff643857c4b108f8f1ecd10d48366","name":"Increment Index","goal_id":"07bbdfc6ff0f4396be715a7c27798990"},{"type":"ScriptedAction","script":"(function execute() {\n    var index = parseInt(vaVars.index);\n    var limit = parseInt(vaVars.limit);\n    var index = index - limit;\n    if (index &lt; 0) \n        index = 0;\n    vaVars.index = index;\n})()\n","id":"3cd6a1712c71416c9177c4d3a8c1b588","name":"Decrement Index","goal_id":"07bbdfc6ff0f4396be715a7c27798990"},{"type":"ScriptedAction","script":"(function execute() {\n    //Find the change requests with the selected ci\n    var gr = new GlideAggregate('change_request');\n    var queryStr = 'cmdb_ci=' + vaInputs.configuration_item.getValue();\n    queryStr += '^end_date&gt;javascript:gs.minutesAgoStart(1)';\n    gr.addEncodedQuery(queryStr);\n    gr.addAggregate('COUNT');\n    gr.query();\n\n    var count = 0;\n    if (gr.next())\n        count = gr.getAggregate('COUNT');\n\n    vaVars.count = count;\n})()\n","id":"f21cf71c3da64aca95dd6fe45861b0ac","name":"Change Requests","goal_id":"07bbdfc6ff0f4396be715a7c27798990"},{"type":"Decision","name":"Decision","branches":[{"type":"Branch","label":"Show Change Requests","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return parseInt(vaVars.count) &gt; 0;\n})()\n"},"id":"da1808807bae469099f65870fb1d2a8c","name":"Show Change Requests"},{"type":"Branch","label":"No Change Requests","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return parseInt(vaVars.count) == 0;\n})()\n"},"id":"f03bceff133d4a53b23aadc2000efb0a","name":"No Change Requests"}],"id":"18aab7083c0e4c09850fa03f3f043e9a","goal_id":"07bbdfc6ff0f4396be715a7c27798990"},{"type":"InputPrompt","variable_id":"903cc5ac26eb4e8c8bfab7e495c0e288","message":{"type":"String","mode":"string","value":"gs.getMessage(\"Would you like to search for something else?\")"},"optional":false,"id":"9e3ccd0d97004a9cacdccebd4dd84079","name":"Try Again","goal_id":"07bbdfc6ff0f4396be715a7c27798990"},{"type":"Decision","name":"Decision","branches":[{"type":"Branch","label":"Search Again","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaInputs.try_again.getValue();\n})()\n"},"id":"18b999cb036f47d191f3729601c91369","name":"Search Again"},{"type":"Branch","label":"Done","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return !vaInputs.try_again.getValue();\n})()\n"},"id":"2f2c0e22ab5c4e8195b476edf94ac76f","name":"Done"}],"id":"d7cf5d1e47634023bd0490296d2a7ca2","goal_id":"07bbdfc6ff0f4396be715a7c27798990"},{"type":"ScriptOutputPrompt","output_type":"single_part","id":"f74221f639f2484a9bf3e42d1d41bea8","name":"Display Change Requests","goal_id":"07bbdfc6ff0f4396be715a7c27798990","value":{"type":"String","mode":"string","value":"(function execute() {\n\n    var gr = new GlideRecordSecure('change_request');\n    var queryStr = 'cmdb_ci=' + vaInputs.configuration_item.getValue();\n    queryStr += '^end_date&gt;javascript:gs.minutesAgoStart(1)';\n    gr.orderBy('start_date');\n    gr.addEncodedQuery(queryStr);\n    gr.chooseWindow(0, parseInt(vaVars.change_limit), true);\n    gr.query();\n\n    vaVars.count = gr.getRowCount();\n\n    var html = '';\n    var htmlGenerator = new sn_itsm_va.VATableGeneratorUtil();\n\n    htmlGenerator.startChangeRequestTable();\n    while (gr.next()) {\n        htmlGenerator.addChangeRequest(gr);\n    }\n    htmlGenerator.endChangeRequestTable();\n    html = htmlGenerator.getChangeRequestOutput();\n    \n    if (gr.getRowCount() &gt; parseInt(vaVars.change_limit)) {\n        var changeLink = '&lt;div width=\"100%\" style=\"text-align: center;\"&gt;' + \n            '&lt;a target=\"_blank\" href=\"' +\n            gs.getProperty('glide.servlet.uri') + '/change_request_list.do?sysparm_query=' +\n            queryStr + '^ORDERBYstart_date\"&gt;' +\n            gs.getMessage('View all planned change requests for {0}', vaInputs.configuration_item.getDisplayValue()) +\n            '&lt;/a&gt;&lt;/div&gt;';\n        html += changeLink;\n    }\n\n    return html;\n})()\n"}},{"type":"OutputPrompt","value":{"type":"String","mode":"string","value":"gs.getMessage(\"Sorry, I couldn't find any related changes.\")"},"id":"2bc57557590949149be2202db2c7fd97","name":"No Change Requests","goal_id":"07bbdfc6ff0f4396be715a7c27798990"},{"type":"ScriptedAction","script":"(function execute() {\n    //Reset index and count here\n    vaVars.index = 0;\n    vaVars.count = 0;\n\n    var gr = new GlideAggregate('cmdb_ci');\n    gr.addQuery('name', 'CONTAINS', vaInputs.search_term);\n    gr.addAggregate('COUNT');\n    gr.query();\n\n    if (gr.next())\n        vaVars.count = gr.getAggregate('COUNT');\n})()\n","id":"6c6a302298c24d1583392b09ccad7583","name":"Configuration Item Count","goal_id":"07bbdfc6ff0f4396be715a7c27798990"},{"type":"Decision","name":"Decision","branches":[{"type":"Branch","label":"Configuration Items Found","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return parseInt(vaVars.count) &gt; 0;\n})()\n"},"id":"109ca55e8abf4e28ba35e5cf553c3cf5","name":"Configuration Items Found"},{"type":"Branch","label":"No Configuration Items Found","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return parseInt(vaVars.count) == 0;\n})()\n"},"id":"617befd43c2742bb88aacd45750ea063","name":"No Configuration Items Found"}],"id":"fe7cdfbb49f14f8a8abc9f6435494cb0","goal_id":"07bbdfc6ff0f4396be715a7c27798990"},{"type":"OutputPrompt","value":{"type":"String","mode":"string","value":"gs.getMessage(\"No matching configuration items were found.\")"},"id":"717456d92b3942349205c76b2c0c99c5","name":"No Configuration Items Found","goal_id":"07bbdfc6ff0f4396be715a7c27798990"}],"edges":[{"type":"Edge","source_node_id":"8d721e089e364ddd91156f40038991b0","target_node_id":"e54d56418c41427dbc8e5aad25b31028","branch_id":"8bc4620b64b94b549d753b961807fdba","id":"75486cb2664c437ba987f495a1751528","name":"8bc4620b64b94b549d753b961807fdba"},{"type":"Edge","source_node_id":"1f7f2014b37d4eb4bd97a81eb2866c1e","target_node_id":"8d721e089e364ddd91156f40038991b0","id":"504376310517467a8c484768610e3c37"},{"type":"Edge","source_node_id":"2d4d497ab61846a8a267abf43825699f","target_node_id":"e54d56418c41427dbc8e5aad25b31028","id":"6df3665cb06e4121b4ef1960c5ec9996"},{"type":"Edge","source_node_id":"8d721e089e364ddd91156f40038991b0","target_node_id":"e225329edbf04e98a0778639049e85c1","branch_id":"9b3042a88f0e4297a5d51dd2bbbb0eb0","id":"965cca07a91e4d6f8c186ce010def2fb","name":"9b3042a88f0e4297a5d51dd2bbbb0eb0"},{"type":"Edge","source_node_id":"8d721e089e364ddd91156f40038991b0","target_node_id":"161ff643857c4b108f8f1ecd10d48366","branch_id":"20c63b8086d948e4a456467fbfdcebd5","id":"f1745bd0ce234499ae7c98ee8037bd76","name":"20c63b8086d948e4a456467fbfdcebd5"},{"type":"Edge","source_node_id":"161ff643857c4b108f8f1ecd10d48366","target_node_id":"1f7f2014b37d4eb4bd97a81eb2866c1e","id":"75233b478c784237951efebff6f43b88"},{"type":"Edge","source_node_id":"8d721e089e364ddd91156f40038991b0","target_node_id":"3cd6a1712c71416c9177c4d3a8c1b588","branch_id":"87d00d5950824aa0af2ccd57f09c60e3","id":"8c284185368a4f28a30a02848e56f2d0","name":"87d00d5950824aa0af2ccd57f09c60e3"},{"type":"Edge","source_node_id":"3cd6a1712c71416c9177c4d3a8c1b588","target_node_id":"1f7f2014b37d4eb4bd97a81eb2866c1e","id":"6b5371432e3e4c049833b8fa866416bf"},{"type":"Edge","source_node_id":"8d721e089e364ddd91156f40038991b0","target_node_id":"f21cf71c3da64aca95dd6fe45861b0ac","branch_id":"abf55588055a469baacde8b09984446f","id":"632105251fcb4ece9580e4ace1dec72e","name":"abf55588055a469baacde8b09984446f"},{"type":"Edge","source_node_id":"f21cf71c3da64aca95dd6fe45861b0ac","target_node_id":"18aab7083c0e4c09850fa03f3f043e9a","id":"2b7c8daf9a72417f93dd6994dead29de"},{"type":"Edge","source_node_id":"9e3ccd0d97004a9cacdccebd4dd84079","target_node_id":"d7cf5d1e47634023bd0490296d2a7ca2","id":"e1e48179021d48ed8ed80f781da459db"},{"type":"Edge","source_node_id":"d7cf5d1e47634023bd0490296d2a7ca2","target_node_id":"e54d56418c41427dbc8e5aad25b31028","branch_id":"18b999cb036f47d191f3729601c91369","id":"e9dabf9a89474a5fb97f1a5412a062d7","name":"18b999cb036f47d191f3729601c91369"},{"type":"Edge","source_node_id":"d7cf5d1e47634023bd0490296d2a7ca2","target_node_id":"e225329edbf04e98a0778639049e85c1","branch_id":"2f2c0e22ab5c4e8195b476edf94ac76f","id":"a486a1b94ed043cca0a8fa0ad510c775","name":"2f2c0e22ab5c4e8195b476edf94ac76f"},{"type":"Edge","source_node_id":"18aab7083c0e4c09850fa03f3f043e9a","target_node_id":"f74221f639f2484a9bf3e42d1d41bea8","branch_id":"da1808807bae469099f65870fb1d2a8c","id":"b4b8def93eed432eaa8d60355cc5b379","name":"da1808807bae469099f65870fb1d2a8c"},{"type":"Edge","source_node_id":"f74221f639f2484a9bf3e42d1d41bea8","target_node_id":"9e3ccd0d97004a9cacdccebd4dd84079","id":"2caf465d346e488ca49e7206173c4de7"},{"type":"Edge","source_node_id":"18aab7083c0e4c09850fa03f3f043e9a","target_node_id":"2bc57557590949149be2202db2c7fd97","branch_id":"f03bceff133d4a53b23aadc2000efb0a","id":"a0a20aedf3224f80a683b8ab79266563","name":"f03bceff133d4a53b23aadc2000efb0a"},{"type":"Edge","source_node_id":"2bc57557590949149be2202db2c7fd97","target_node_id":"9e3ccd0d97004a9cacdccebd4dd84079","id":"2912723991a14e6fa4bcf1edba21c9dc"},{"type":"Edge","source_node_id":"e54d56418c41427dbc8e5aad25b31028","target_node_id":"6c6a302298c24d1583392b09ccad7583","id":"f9512010aed44e0b86f5ff8454f9189a"},{"type":"Edge","source_node_id":"6c6a302298c24d1583392b09ccad7583","target_node_id":"fe7cdfbb49f14f8a8abc9f6435494cb0","id":"b591f82ff56e4c569d2874a180cee66a"},{"type":"Edge","source_node_id":"fe7cdfbb49f14f8a8abc9f6435494cb0","target_node_id":"1f7f2014b37d4eb4bd97a81eb2866c1e","branch_id":"109ca55e8abf4e28ba35e5cf553c3cf5","id":"5df4741591b74b57a35e6d3ded5d228f","name":"109ca55e8abf4e28ba35e5cf553c3cf5"},{"type":"Edge","source_node_id":"fe7cdfbb49f14f8a8abc9f6435494cb0","target_node_id":"717456d92b3942349205c76b2c0c99c5","branch_id":"617befd43c2742bb88aacd45750ea063","id":"643b7ec15d1642498a000cbf656f1bbe","name":"617befd43c2742bb88aacd45750ea063"},{"type":"Edge","source_node_id":"717456d92b3942349205c76b2c0c99c5","target_node_id":"9e3ccd0d97004a9cacdccebd4dd84079","id":"d4cb8b1f2ab345c5a7218c2c6db298c5"}],"id":"07bbdfc6ff0f4396be715a7c27798990"}],"script_variables":[{"type":"String","name":"LiveAgent_application","value":{"type":"String","mode":"string","value":"itsm"},"id":"e6d7731c8bab4228aa8c30b21adf0fb1"},{"type":"String","name":"count","value":{"type":"String","mode":"string","value":"0"},"id":"9d34a2104c43461aa5c4035a3fd2dd62"},{"type":"String","name":"limit","value":{"type":"String","mode":"string","value":"5"},"id":"0a9dba1489ce4417a24be410d4306806"},{"type":"String","name":"index","value":{"type":"String","mode":"string","value":"0"},"id":"b418741c66344a41a4bc558a54ab7a46"},{"type":"String","name":"results","value":{"type":"String","mode":"string"},"id":"b5fe5349e7c34f6a8fa1219d1dea0169"},{"type":"String","name":"change_limit","value":{"type":"String","mode":"string","value":"3"},"id":"e730801298d342da9595d42ba83068bf"}],"glide_variables":[{"type":"String","name":"search_term","id":"6b8b352e39ee4a5ab63a274b83e02c8e"},{"type":"Choice","choices":[],"id":"11d7e6234f6d41f9b44789f890750165","name":"configuration_item","table":""},{"type":"True/False","id":"903cc5ac26eb4e8c8bfab7e495c0e288","name":"try_again"},{"type":"Reference","table":"sys_user","id":"current-user","name":"user"}],"roles":["itil"],"scope":"134450a0b3781300787162ac16a8dc1e","id":"668feeb35b0c630070e4492c11f91af0","name":"Identify Scheduled Changes","key_phrases":["scheduled","changes","ci","planned","change schedule"]}</design_definition>
        <design_topic_id>668feeb35b0c630070e4492c11f91af0</design_topic_id>
        <name>Identify Scheduled Changes</name>
        <sys_class_name>sys_cb_design_topic</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2019-07-24 22:15:55</sys_created_on>
        <sys_domain>global</sys_domain>
        <sys_id>5b9b4b1aeb723300749c3c4fea887e7f</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>FlowTopic</sys_name>
        <sys_package display_value="NeedIt" source="x_58872_needit">6ead8e780f603200cd674f8ce1050ed1</sys_package>
        <sys_policy/>
        <sys_scope display_value="NeedIt">6ead8e780f603200cd674f8ce1050ed1</sys_scope>
        <sys_update_name>sys_cb_design_topic_5b9b4b1aeb723300749c3c4fea887e7f</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2019-07-24 22:15:55</sys_updated_on>
        <type>FlowTopic</type>
    </sys_cb_design_topic>
</record_update>
